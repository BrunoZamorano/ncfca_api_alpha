<task>
    Implement User Search Endpoint for Admins (CQRS Query)
</task>

<taskspec>
This task involves creating a new endpoint to allow administrators to search for users with pagination and filtering capabilities. The implementation must follow the project's established CQRS pattern for queries, where a dedicated query model is used for reading data.

For a reference on the query pattern, see the `ListTrainings` use case (`@src/application/use-cases/training/list-training/list-trainings.use-case.ts`) and its corresponding query implementation (`@src/infraestructure/queries/training.query.prisma.ts`).

The new endpoint will be secure and accessible only to users with an 'Admin' role.
</taskspec>

# Architectural Implementation Plan

This plan outlines the creation of the necessary components across the different layers of the application, following the CQRS pattern.

<details>
<summary><strong>1. DTOs (`domain/dtos`)</strong></summary>

*   **Create Query DTO**: A new DTO is needed to handle the search query parameters.
    *   **File**: `src/domain/dtos/search-users-query.dto.ts`
    *   **Guidance**: Create a `SearchUsersQueryDto` class that extends `PaginationDto`. It should include an optional `term` property of type string for filtering. Look at `@src/domain/dtos/search-clubs-query.dto.ts` for an example.

*   **Create Paginated Output DTO**: Update the paginated output DTO to include a type for a paginated list of users.
    *   **File**: `src/domain/dtos/paginated-output.dto.ts`
    *   **Guidance**: Add a new class `PaginatedUserDto` that extends `PaginatedOutput<UserDto>`. It should define the `data` property as an array of `UserDto`. See `PaginatedClubDto` in the same file for a reference.
</details>

<details>
<summary><strong>2. CQRS Query (`application/queries` & `infraestructure/queries`)</strong></summary>

*   **Define Query Interface**: Create the contract for the user query in the application layer.
    *   **Directory**: `src/application/queries/user-query/`
    *   **File**: `src/application/queries/user-query/user-query.interface.ts`
    *   **Guidance**: Define a `UserQuery` interface. It should have a `search` method with the signature: `search(query: SearchUsersQueryDto): Promise<PaginatedUserDto>`. This interface will serve as the injection token.

*   **Implement Query**: Create the Prisma implementation of the query in the infrastructure layer.
    *   **File**: `src/infraestructure/queries/user.query.prisma.ts`
    *   **Guidance**: Create a `UserQueryPrisma` class that implements the `UserQuery` interface. The `search` method will contain the Prisma Client logic to perform a paginated query on the User model. It should filter users by the `term` (on name/email) and map the raw data directly to `UserDto` objects, returning a `PaginatedUserDto`.
</details>

<details>
<summary><strong>3. Use Case (`application/use-cases`)</strong></summary>

*   **Create Use Case**: Develop the use case that orchestrates the user search.
    *   **Directory**: `src/application/use-cases/search-users/`
    *   **File**: `src/application/use-cases/search-users/search-users.ts`
    *   **Guidance**: Create an injectable `SearchUsers` class. Its constructor should inject the `UserQuery` interface. The `execute` method will take `SearchUsersQueryDto` as input, delegate the call directly to `this._userQuery.search(query)`, and return the result.

</details>

<details>
<summary><strong>4. Controller (`infraestructure/controllers`)</strong></summary>

*   **Create Controller Endpoint**: Expose the `SearchUsers` use case through a new endpoint in the admin controller.
    *   **File**: `src/infraestructure/controllers/admin/admin.controller.ts`
    *   **Guidance**: Inject the `SearchUsers` use case into the `AdminController`. Create a new GET endpoint at `/admin/users`. This endpoint should use the `SearchUsersQueryDto` as its query parameter. It must be protected by `AuthGuard` and a `RolesGuard` to ensure only users with the `Admin` role can access it. Use Swagger decorators (`@ApiOperation`, `@ApiResponse`) to document the endpoint. The method will call the use case's `execute` method and return the result.
</details>

# Instructions

*   **Follow the Architecture**: Strictly adhere to the `controller -> use case -> query` pattern for read operations.
*   **Testing**: Add unit tests for the `SearchUsers` use case, mocking the `UserQuery` dependency. If time permits, create a new e2e test file (`test/admin.e2e-spec.ts`) to cover the new endpoint.
*   **Security**: Ensure the endpoint is accessible only by administrators. A `RolesGuard` and `@Roles` decorator should be used.
*   **Module Registration**: Register all new providers (`SearchUsers` use case, `UserQueryPrisma`) in the appropriate NestJS modules to ensure dependency injection works correctly. The `UserQueryPrisma` should be provided for the `UserQuery` token.

# Critical

*   **CQRS Principle**: The query implementation (`UserQueryPrisma`) is responsible for all data fetching and mapping to DTOs. The use case should only orchestrate the call.
*   **Error Handling**: Implement proper error handling within the query implementation.
*   **Code Style**: Adhere to the existing code style, formatting (`.prettierrc`), and linting rules (`eslint.config.mjs`).