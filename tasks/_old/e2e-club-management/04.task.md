status: pending

Título curto
- Matrículas: aprovar e rejeitar

Objetivo
- Implementar testes E2E para aprovar e rejeitar solicitações de matrícula, cobrindo sucesso e cenários negativos de autorização, existência e regras de domínio.

Arquivos e caminhos (criar/editar)
- Criar: `test/club-management/approve-enrollment.e2e-spec.ts`
- Criar: `test/club-management/reject-enrollment.e2e-spec.ts`

Contratos e estruturas (DTOs/entities/interfaces e campos)
- Aprovar: `POST /club-management/enrollments/:enrollmentId/approve` ⇒ 204.
- Rejeitar: `POST /club-management/enrollments/:enrollmentId/reject` com body `{ reason: string }` ⇒ 204.
- Domínio: `EnrollmentStatus` deve transicionar de `PENDING` para `APPROVED`/`REJECTED`; aprovar cria `ClubMembership` ativo; rejeitar grava `rejection_reason`.

Regras de negócio e validações
- Somente o dono do clube (owner) pode aprovar/rejeitar matrículas daquele clube; 403 caso contrário.
- `enrollmentId` deve existir; 404 caso contrário.
- Aprovar: família deve estar afiliada; clube não pode estar em capacidade máxima; request deve estar `PENDING`.
- Rejeitar: requer `reason` não-vazio.

Passo a passo
1. Setup: criar dono e clube; criar família `AFFILIATED` com dependente e `EnrollmentRequest` `PENDING` para o clube. Criar também variações para cenários negativos (ex.: `NOT_AFFILIATED`, `club.max_members` atingido, request `APPROVED`).
2. `approve-enrollment.e2e-spec.ts`:
   - Caso feliz: 204; assert no Prisma que `enrollmentRequest.status === APPROVED` e existe `clubMembership` `ACTIVE` para `dependant_id`/`family_id`/`club_id`.
   - Já aprovado/rejeitado: 422/409 equivalente via exceção de domínio (`InvalidOperationException`).
   - Capacidade máxima atingida: 422.
   - Família não afiliada: 422.
   - Ownership inválido: 403.
   - Id inexistente: 404.
   - Sem token: 401.
3. `reject-enrollment.e2e-spec.ts`:
   - Caso feliz: 204; assert no Prisma que `status === REJECTED` e `rejection_reason` preenchido.
   - Ownership inválido: 403.
   - Id inexistente: 404.
   - Sem `reason`: 400 (validação DTO).
   - Sem token: 401.
4. Cleanup cirúrgico ao final da suíte.

Critérios de aceite (checáveis)
- Todos os cenários descritos com asserts claros em status e persistência via Prisma.
- Nomes de testes focados em regra de negócio em PT-BR.

Testes mínimos (âncoras de teste)
- `it('Deve aprovar uma matrícula pendente e válida', ...)`.
- `it('Não deve aprovar matrícula quando o clube está lotado', ...)`.
- `it('Deve rejeitar matrícula registrando o motivo', ...)`.

Notas de versão/refs do Context7 (curtas)
- Regras: `AI/rules/test.standards.yml`.

