status: pending

# Refatorar main.ts para usar ConfigService

## Objetivo
Usar `ConfigService` no `bootstrap` para ler `PORT`, `CORS_ORIGIN` e `RABBITMQ_URL`, e condicionar a conexão do microservice quando em `NODE_ENV=test` (evitando side effects nos testes quando apropriado).

## Arquivos e caminhos (criar/editar)
- Editar: `src/main.ts`

## Contratos e estruturas
N/A.

## Regras de negócio e validações
- Evitar acessar `process.env` diretamente; preferir `ConfigService`.
- Conectar o microservice de RabbitMQ apenas quando não estiver em `NODE_ENV=test` OU quando houver `RABBITMQ_URL` válido.
- `app.listen` deve usar a porta de `ConfigService.get<number>('PORT') || 3000`.

## Passo a passo
1. Obter `const config = app.get(ConfigService)` após criar o app.
2. Ler `const isTest = config.get<string>('NODE_ENV') === 'test'`.
3. Ler `const rabbitUrl = config.get<string>('RABBITMQ_URL')` e `const corsOrigin = config.get<string>('CORS_ORIGIN') || '*'`.
4. Só chamar `app.connectMicroservice({...})` quando `!isTest && rabbitUrl`.
5. Usar `config.get<number>('PORT')` para `app.listen`.

## Critérios de aceite (checáveis)
- Em `NODE_ENV=test`, `bootstrap` não tenta conectar ao RabbitMQ (a não ser que explicitamente desejado pelos testes E2E, que conectam por conta própria).
- Em `NODE_ENV=development`, a aplicação inicia com CORS e microservice conforme configurações.
- Não há acessos diretos remanescentes a `process.env` no `main.ts`.

## Testes mínimos (âncoras)
- Smoke: subir app com `NODE_ENV=test` e verificar que não há tentativa de conexão externa no log do bootstrap.
- E2E existentes devem continuar executando; quando conectarem microservice explicitamente nos testes, usarão o `RABBITMQ_URL` do `.env.test`.

## Notas de versão/refs do Context7
- `ConfigService` provido por `@nestjs/config` v3; uso idiomático em Nest v11.

